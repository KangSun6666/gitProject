<!DOCTYPE html>
<html lang="en" html xmlns:th=http://www.thymeleaf.org>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <!-- 引入样式文件和动态控制 -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <script src="/static/js/jquery-3.2.1.min.js"></script>
    <script src="/static/js/jquery-3.2.1.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <title>我的预约</title>

    <link th:href="@{/static/css/bootstrap.min.css}" rel="stylesheet" />
    <link th:href="@{/static/font-awesome/css/font-awesome.css}" rel="stylesheet" />
    <link th:href="@{/static/css/style.css}" rel="stylesheet" />
<script type="text/javascript">

	$(function() {
	    <!--$.ajaxSetup({-->
                <!--complete:function(){-->
                    <!--if("REDIRECT" == jqxhr.getResponseHeader("REDIRECT")){ //若HEADER中含有REDIRECT说明后端想重定向，-->
                        <!--var win = window;-->
                        <!--while(win != win.top){-->
                            <!--win = win.top;-->
                        <!--}-->
                        <!--win.location.href = jqxhr.getResponseHeader("CONTENTPATH");//将后端重定向的地址取出来,使用win.location.href去实现重定向的要求-->
                    <!--}-->
                <!--}-->
        <!--});-->
        <!--var jqxhr;-->
		$(".btn").click(function() {
			$.ajax({
				url : "/appo/useMachine",//请求的url
				type : "post",//请求方式
				data : {//传递的数据
				    id : $(this).parents("tr").children("td:nth-child(1)").text(),
					pstart_use_time : $(this).parents("tr").children("td:nth-child(6)").text(), //获取当前<td>所在的<tr>中的第n个<td>的text值
					pend_use_time : $(this).parents("tr").children("td:nth-child(7)").text()
				},
				dataType : "text",//后台数据返回类型
				success : function(data) {//响应成功执行的方法
					alert(data);
					if(data =="时间正确，允许使用"){
					    window.location.href="/appo/using";
					}
				},
				error : function() {//出现异常执行方法
					alert("出现异常啦...");
				}
			});
		});
		$(".cancel").click(function() {
		    $.ajax({
                url : "/appo/cancelAppointment",//请求的url
                type : "post",//请求方式
                data : {//传递的数据
                    id : $(this).parents("tr").children("td:nth-child(1)").text(), //获取当前<td>所在的<tr>中的第n个<td>的text值
                },
                dataType : "text",//后台数据返回类型
                success : function(data1) {//响应成功执行的方法
                    alert(data1);
                    window.location.reload();
                },
                error : function() {//出现异常执行方法
                    alert("出现异常啦...");
                }
            });
		});
	});
</script>

</head>
<body>
<div id="wrapper">
    <nav class="navbar-default navbar-static-side" role="navigation" th:include="nav-client :: navigation"></nav>
    <div id="page-wrapper" class="gray-bg">
        <div class="border-bottom" th:include="header-client :: headerTop"></div>
        <div class="row wrapper border-bottom white-bg page-heading" th:fragment="headerNav">
            <div class="col-lg-10">
                <h2>预约查询</h2>
                <ol class="breadcrumb">
                    <li>
                        <a>首页</a>
                    </li>
                    <li>
                        <a>我的预约</a>
                    </li>
                    <li class="active">
                        <a>查看预约</a>
                    </li>
                </ol>
            </div>
            <div class="col-lg-2">
            </div>
        </div>
        <div class="table-responsive">
            <table id="tabel1" class="table table-striped ">
                <tr>
                    <td>序号</td>
                    <td>用户编号</td>
                    <td>用户名</td>
                    <td>预约设备</td>
                    <td>设备用途</td>
                    <td>开始时间</td>
                    <td>结束时间</td>
                    <td>操作</td>
                </tr>
                <tr th:each="a:${appo1}">
                    <td th:text="${a.id}"></td>
                    <td th:text="${a.use_id}"></td>
                    <td th:text="${a.use_name}"></td>
                    <td th:text="${a.machine_id}"></td>
                    <td th:text="${a.machine_usage}"></td>
                    <td id="pstart_use_time" th:text="${#dates.format(a.pstart_use_time, 'yyyy-MM-dd HH:mm:ss')}"></td>
                    <td id="pend_use_time" th:text="${#dates.format(a.pend_use_time, 'yyyy-MM-dd HH:mm:ss')}"></td>
                    <td>
                        <a id="submit" class="btn btn-primary btn-primary" >开始使用</a>
                        <a id="a" style="color:red" class="cancel">取消预约</a>
                        <!--th:href="@{'/appo/cancelAppointment?id='+${a.id}}"-->
                    </td>
                </tr>
            </table>
        </div>
        <div align="center">
            <ul class="pagination">
                <li><a href="#">&laquo;</a></li>
                <li><a href="#">1</a></li>
                <li><a href="#">2</a></li>
                <li><a href="#">3</a></li>
                <li><a href="#">4</a></li>
                <li><a href="#">5</a></li>
                <li><a href="#">&raquo;</a></li>
            </ul>
        </div>
    </div>
    <div class="footer" th:include="footer-client :: copyright"></div>
</div>
</div>
<!-- Mainly scripts -->
<script th:src="@{/static/js/jquery-2.1.1.js}"></script>
<script th:src="@{/static/js/bootstrap.min.js}"></script>
<script th:src="@{/static/js/plugins/metisMenu/jquery.metisMenu.js}"></script>
<script th:src="@{/static/js/plugins/slimscroll/jquery.slimscroll.min.js}"></script>

<!-- Peity -->
<script th:src="@{/static/js/plugins/peity/jquery.peity.min.js}"></script>

<!-- Custom and plugin javascript -->
<script th:src="@{/static/js/inspinia.js}"></script>
<script th:src="@{/static/js/plugins/pace/pace.min.js}"></script>

<!-- Toastr script -->
<script th:src="@{/static/js/plugins/toastr/toastr.min.js}"></script>

<!-- common -->
<script th:src="@{/static/js/common.js}"></script>
</body>
</html>