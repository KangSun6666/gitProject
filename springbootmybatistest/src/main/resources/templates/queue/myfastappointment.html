<!DOCTYPE html>
<html lang="en" html xmlns:th=http://www.thymeleaf.org>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <!-- 引入样式文件和动态控制 -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <script src="/static/js/jquery-3.2.1.min.js"></script>
    <script src="/static/js/jquery-3.2.1.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <title>我的预约</title>

    <link th:href="@{/static/css/bootstrap.min.css}" rel="stylesheet" />
    <link th:href="@{/static/font-awesome/css/font-awesome.css}" rel="stylesheet" />
    <link th:href="@{/static/css/style.css}" rel="stylesheet" />
    <script type="text/javascript">

    $(document).ready(function(){

        window.setInterval("a()",3000); //每三秒钟访问一次服务器获取信息
    });

    function a() {
        $.ajax({
            url : "/que/seeIndex",//请求的url
            type : "post",//请求方式
            data : {//传递的数据
                id : $("#id1").text()
            },
            dataType : "text",//后台数据返回类型
            success : function(data) {//响应成功执行的方法
                $("#text1").val(data);
            }
        });
    }

	$(function() {
		$(".btn").click(function() {
			$.ajax({
				url : "/que/useMachine",//请求的url
				type : "post",//请求方式
				data : {    //传递的数据
				    id : $(this).parents("tr").children("td:nth-child(1)").text()  //获取当前<td>所在的<tr>中的第n个<td>的text值
				},
				dataType : "text",//后台数据返回类型
				success : function(data) {//响应成功执行的方法
					alert(data);
					if(data =="时间正确，允许使用"){
					    window.location.href="/que/using";
					}
				},
				error : function() {//出现异常执行方法
					alert("出现异常啦...");
				}
			});
		});
		$(".cancel").click(function() {
		    $.ajax({
                url : "/que/cancelAppointment",//请求的url
                type : "post",//请求方式
                data : {//传递的数据
                    id : $(this).parents("tr").children("td:nth-child(1)").text(), //获取当前<td>所在的<tr>中的第n个<td>的text值
                },
                dataType : "text",//后台数据返回类型
                success : function(data1) {//响应成功执行的方法
                    alert(data1);
                    window.location.reload();
                },
                error : function() {//出现异常执行方法
                    alert("出现异常啦...");
                }
            });
		});
	});
</script>

</head>
<body>
<div id="wrapper">
    <nav class="navbar-default navbar-static-side" role="navigation" th:include="nav-client :: navigation"></nav>
    <div id="page-wrapper" class="gray-bg">
        <div class="border-bottom" th:include="header-client :: headerTop"></div>
        <div class="row wrapper border-bottom white-bg page-heading" th:fragment="headerNav">
            <div class="col-lg-10">
                <h2>预约查询</h2>
                <ol class="breadcrumb">
                    <li>
                        <a>首页</a>
                    </li>
                    <li>
                        <a>我的预约</a>
                    </li>
                    <li class="active">
                        <a>查看预约</a>
                    </li>
                </ol>
            </div>
            <div class="col-lg-2">
            </div>
        </div>
        <div class="table-responsive">
            <table id="tabel1" class="table table-striped ">
                <tr>
                    <td>序号</td>
                    <td>用户编号</td>
                    <td>用户名</td>
                    <td>预约设备</td>
                    <td>设备用途</td>
                    <td>操作</td>
                </tr>
                <tr th:each="a:${appo1}">
                    <td id="id1" th:text="${a.id}"></td>
                    <td th:text="${a.use_id}"></td>
                    <td th:text="${a.use_name}"></td>
                    <td th:text="${a.machine_id}"></td>
                    <td th:text="${a.machine_usage}"></td>
                    <td>
                        <a id="submit" class="btn btn-primary btn-primary" >开始使用</a>
                        <a id="a" style="color:red" class="cancel">取消预约</a>
                        <!--th:href="@{'/appo/cancelAppointment?id='+${a.id}}"-->
                    </td>
                </tr>
            </table>
        </div>
        <div>
            <!--<button id="button1">点击查看排队情况</button>-->
            <input type="text" id="text1" class="form-control" style="color:red">
        </div>
    </div>
    <div class="footer" th:include="footer-client :: copyright"></div>
</div>
</div>
<!-- Mainly scripts -->
<script th:src="@{/static/js/jquery-2.1.1.js}"></script>
<script th:src="@{/static/js/bootstrap.min.js}"></script>
<script th:src="@{/static/js/plugins/metisMenu/jquery.metisMenu.js}"></script>
<script th:src="@{/static/js/plugins/slimscroll/jquery.slimscroll.min.js}"></script>

<!-- Peity -->
<script th:src="@{/static/js/plugins/peity/jquery.peity.min.js}"></script>

<!-- Custom and plugin javascript -->
<script th:src="@{/static/js/inspinia.js}"></script>
<script th:src="@{/static/js/plugins/pace/pace.min.js}"></script>

<!-- Toastr script -->
<script th:src="@{/static/js/plugins/toastr/toastr.min.js}"></script>

<!-- common -->
<script th:src="@{/static/js/common.js}"></script>
</body>
</html>